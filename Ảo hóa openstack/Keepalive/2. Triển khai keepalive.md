### I. Mô hình

![a](https://f5-zpcloud.zdn.vn/6837030862143115219/f5457e6e9a0c5e52071d.jpg)

### II. Chuẩn bị

**Thực hiện trên 2 node**

```
sed -i 's/SELINUX=enforcing/SELINUX=disabled/g' /etc/sysconfig/selinux
sed -i 's/SELINUX=enforcing/SELINUX=disabled/g' /etc/selinux/config
```

```
yum install epel-release -y
yum update -y
```

**Cài đặt NTPD**

```
yum install chrony -y
systemctl start chronyd 
systemctl enable chronyd
systemctl restart chronyd 
chronyc sources -v
```

```
sudo date -s "$(wget -qSO- --max-redirect=0 google.com 2>&1 | grep Date: | cut -d' ' -f5-8)Z"
ln -f -s /usr/share/zoneinfo/Asia/Ho_Chi_Minh /etc/localtime
```



### Cài đặt Apache trên 2 node master và backup

```
yum update httpd
yum install httpd -y
systemctl start httpd
```

![a](https://f5-zpcloud.zdn.vn/2427581306677936609/917268e9d68b12d54b9a.jpg)

![a](https://f5-zpcloud.zdn.vn/5943691234422197434/45fe0a8fb4ed70b329fc.jpg)


### Cài đặt keepalive

1. Trên cả 2 node:

- Cài đặt: `

```
yum -y install kernel-headers kernel-devel

yum install keepalived

cp /etc/keepalived/keepalived.conf /etc/keepalived/keepalived.conf.bak

systemctl start keepalived
systemctl enable keepalived
```

### Cấu hình keepalive

1. Trên mode master

- Chỉnh sửa file: `/etc/keepalived/keepalived.conf`

```
vrrp_script chk_httpd {
    script "killall -0 httpd"
    interval 2
    weight 2
}
vrrp_instance VI_1 {
    interface eth0
    state MASTER
    virtual_router_id 51
    priority 101
    virtual_ipaddress {
        172.16.2.100/20
    }
    track_script {
        chk_httpd
    }
}

```

```
systemctl restart keepalived
```

2. Trên node slave

- chỉnh sửa file `/etc/keepalived/keepalived.conf`

```
vrrp_script chk_httpd {
    script "killall -0 httpd"
    interval 2
    weight 2
}
vrrp_instance VI_1 {
    interface eth0
    state BACKUP
    virtual_router_id 51
    priority 99
    virtual_ipaddress {
        172.16.2.100/20
    }
    track_script {
        chk_httpd
    }
}
```

```
systemctl restart keepalived
```




