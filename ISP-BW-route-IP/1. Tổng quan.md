# Lý thuyết

## 1. ISP (Internet Service Provider)

- Là nhà cung cấp dịch vụ Internet chuyên cung cấp các giải pháp kết nối mạng toàn cầu cho các cá nhân và tổ chức.
- Hiểu đơn giản, ISP có thể là một công ty, tổ chức cung cấp cho các nhân hoặc những công ty khác quyền truy cập Internet cũng như các dịch vụ liên quan khác như website, lưu trữ ảo,...

- **Một số nhà cung cấp ISP đang sử dụng**: FPT, VNPT, CMC, Viettel.

## 2. Hệ thống mạng được cung cấp của Nhân Hòa:

- Trung tâm internet Việt Nam (VNNIC - Vietnam Internet Network Information Center) chịu trách nhiệm về quản lý tên miền trong lãnh thổ Việt NAm, cũng như thống tình hình sử dụng Internet của VietNam.
- VNNIC là nơi thiết lập, quản lý, khai thác hai hạ tầng chủ yếu của mạng Internet VietNam là hệ thống máy chủ DNS quốc gia và Trạm trung chuyển Internet quốc gia **VNIX** nắm giữ sự sống còn của Internet VietNam.

![a](https://f7-zpcloud.zdn.vn/1922357048725556840/fc1f8a6d600eb850e11f.jpg)

- Để có được IP để sử dụng đi ra ngoài Internet:
  - Sau khi đăng ký xin cấp các địa chỉ IP cho Nhân Hòa từ VNNIC
  - Các IP sẽ được định tuyến cho một ISP (ở ví dụ đây là FPT)
  - Sau đó các IP được cấp sẽ được gán cho Core Nhân Hòa.
  - Từ đó các server được cấp Ip sẽ đi qua core Nhân Hòa -> ISP -> Đi ra Internet.

## 3. Đường đi của Server:

- Trong quá trình sử dụng ta luôn muốn đạt được phương án tối ưu nhất để có thể có kết quả nhanh nhất. Trên đường đi của server cũng vậy, ta muốn đến được điểm đích nhanh nhất thì phải kiểm tra đường đi của chúng.
- Đường đi ta xác định điểm đích đến, đi qua các trạm trung chuyển.
- Có 2 hướng kết nối **Peering** (Kết nối trao đổi trực tiếp) và **không peering** (kết nối qua trung gian VNIX)
  - Khi sử dụng Peering: Sẽ kết nối trực điểm với nhau, giảm hops -> thời gian đến đích nhanh hơn, Bandwidth được tối ưu. (thỏa thuận giữa các ISP)
  - Khi không sử dụng Peering: Kết nối sẽ phải đi qua trng gian VNIX, đi qua nhiều trạm chung chuyển-> thời gian k được tối ưu -> Bandwidth bị giới hạn do sử dụng chung với nhiều khách hàng khác.

- `hops`: Là số các bước truyền trong đường dẫn để tới đích đến. 

## 4. Bandwidth: 

- Là lưu lượng dữ liệu được truyền đi trong 1s. Băng thông càng lớn tốc độ truyền tải dữ liệu càng nhanh.
- Đơn vị thường được sử dụng là bit/s (bps) hoặc byte/s (Bps).
- Bandwidth thì có trong nước và quốc tế.
- Bandwidth có được chia ra làm 2 loại: Bandwidth share và bandwidth riêng:
  - Bandwidth share có thể kể đến như dịch vụ cloud, shared host 
  - Bandwidth riêng có thể kể đến dịch vụ dedi

# II. Lab

## 1. Kiểm tra đường đi gói tin

- **Trên server Windows**: Ta sử dụng lệnh `tracert "IP" ` trên cmd.
  - `tracert` là công cụ kiểm tra đường đi, xem nó đi qua các trạm nào, thời gian đi qua, có xảy ra tắc nghẽn hoặc không kết nối được.

![a](https://f8-zpcloud.zdn.vn/1771863958566087576/1ceafcdf32b0eaeeb3a1.jpg)

  - Xác định đường đi đến địa chỉ 103.28.37.105
  - Dòng 1: Hiển thị kết quả kết nối tới modem và độ trễ
  - Từ dòng 2 trở đi là kết nối trong mạng giữa các ISP với nhau. 
  - Khi xuất hiện dấu * hay *Request timed out*  có thể là do:
     - Các packet đến router có firewall ngăn chặn tracert theo dõi lộ trình
     - Kết nối router đang có sự cố.
   
- **RTT (Round Trip Time)**: Thời gian cần thiết để một gói tin đi đến bước nhảy và quay lại. Theo mặc định `tracert` gửi gửi 3 gói cho mỗi hop, vì vậy đầu ra liệt kê 3 lần khứ hồi trên cho mỗi bước nhảy. Một yếu tố quan trọng có thể ảnh hưởng đến RTT là khoảng cách vật lý.

```
Hop   RTT1     RTT2    RTT3    Name [IP Address]
```



   - Ở đây có thể thấy được kiểu kết nối `Peer`: Kết nối đi trực tiếp từ mạng VNPT sang mạng FPT
   - Ta có thể vào trang: `https://vnnic.vn/diachiip?lang=en` để kiểm tra địa chỉ IP đang ở các ISP nào.

- **Trên server Linux**: Ở đay sử dụng centos7, ta sử dụng công cụ `traceroute`
  - cài đặt traceroute: `yum -y install traceroute`

![a](https://f8-zpcloud.zdn.vn/9075235301359176574/34dfb29a9aeb42b51bfa.jpg)

  - `traceroute` tương tự như `tracert` là công cụ kiểm tra quãng đường đi.
  - Kiểu kết nối ở đây ta thấy không sử dụng `Peering`, tức là sẽ phải đi qua trung gian. 
  - Ở đây ta đang đứng từ nhà mạng CMC xem đường đi đến địa chỉ FPT ta thấy đi qua 1 địa chỉ `218.100.14.7` đây là địa chỉ của VNIX.

## 2. Kiểm tra Bandwidth 

- **TRên server Windowns**: 
  - Ta có thể sử dụng thông qua trang web `https://www.speedtest.net/` để có thể đo được băng thông.

![a](https://f8-zpcloud.zdn.vn/435288557944242847/380b03f18f8057de0e91.jpg)

- **TRên server Linux**: Ta sử dụng speedtest và cài đặt

```
curl -s https://packagecloud.io/install/repositories/ookla/speedtest-cli/script.rpm.sh | sudo bash
sudo yum install speedtest
```

![a](https://f7-zpcloud.zdn.vn/250218588447238253/2a998eab4fda9784cecb.jpg)


## 3. Packet loss

- Công cụ MTR (My Traceroute) dùng để để đánh giá, phân tích trạng thái network
- MTR là công cụ gồm 2 chương trình `traceroute` và `ping`. Khi sử dụng `mtr` nó sẽ kết nối giữa máy cài đặt `mtr` và một máy chủ khác thông qua ip hoặc hostname bằng cách gửi các packet TTLs (time-to-live) với chỉ số khác nhau cho tới đích, các gói tin được gửi liên tục, % tỉ lệ được tính bằng các gói tin gửi đi, gói tin gửi về và từ đó đưa ra đánh giá về tình trạng network.

-**cài đặt MTR trên Linux**: `yum install mtr -y`
- **Sử dụng**:
   - Kiểm tra kết nối: `mtr [domain/IP]`

```
mtr 103.28.39.144
```

![a](https://f8-zpcloud.zdn.vn/4622794802515550583/11cd444db931616f3820.jpg)


 - `mtr -c [n] [domain/IP]`: Với option -c giới hạn [n] số gói ti gửi đi:

   - `mtr -c 10 103.28.39.144`:

![a](https://f8-zpcloud.zdn.vn/4622794802515550583/11cd444db931616f3820.jpg)

- **CÁc thông số hiển thị**:
  - *Host*: Các hope mà packet đã đi qua
  - *Lost*: Tỉ lệ phần trăm gói tin bị lỗi khi truyền tới hop
  - *Snt*: Số gói tin được gửi đi
  - *Last*: Độ trễ của gói tin cuối cùng được gửi
  - *Avg*: Là độ trễ trung bình của tất cả các gói 
  - *Best* và *Wrst*: Là thời gian phản hồi nhanh nhất và chậm nhất
  - *StDev*: Độ lệch chuẩn. Độ lệch chuẩn càng cao, sự khác biệt giữa các phép đo có độ trễ càng lớn.






