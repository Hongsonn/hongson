# Giao thức VTP (VLAN Trunk Protocol) - giao thức hoạt động ở tầng lk dữ liệu trong mô hình OSI

- Tác dụng đồng nhất các thông tin VLAN trong cùng 1 VTP domain giúp giảm đi cấu hình giống nhau trên các switch.
- Sử dụng mode trunk để cho phép nhiều VLAN đi qua
- Dùng chung 1 kết nối vật lý nên cần phân biệt được các Vlan nào đi qua, cần 1 gói tin đánh dấu hiệu gọi là "tagging".
Giao thức được sử dụng là 802.1Q (dot1q) - giao thức chuẩn IEEE được nhận dạng các VLAN bằng cách thêm vào "frame header" đặc biệt của 1 VLAN. Phương thức này gọi là gắn thẻ VLAN (frame tagging).

1. VTP:
- VTP Domain: Xác định các switch cùng domain để có thể đồng bộ
- VTP Password: Chống các switch lạ cắm vào mô hình switch

2. Hoạt động:
- VTP gửi xác nhận 5p/ 1 lần qua VTP Domain, hoặc khi xảy ra thay đổi trong quá trình cấu hình VLAN.
- 1 thông điệp VTP bao gồm: `rivision number`, tên VLAN, số hiệu VLAN.
- Khi cấu hình VTP server: việc quản bá thông tin VTP tất cả các sw đều đồng bộ về tên và số hiệu của tất cả VLAN.

- `rivision number`: Mỗi thành phần VTP Server điều chỉnh VLAN thì `rivision number` sẽ tăng lên 1. VTP Server sẽ gửi thông tin VTP đi sau đó sẽ so sánh với các sw khác. nếu `rivision number` lớn hơn nó sẽ cập nhật cấu hình VLAN.

![a](https://f8-zpcloud.zdn.vn/7851454938017560812/1a09f579caed0cb355fc.jpg)

**VTP hoạt động ở 1 trong 3 cơ chế sau**:
- Server 
- Client 
- Transparent

![a](https://f8-zpcloud.zdn.vn/4033613445464215153/9ea72f6c0df8cba692e9.jpg)

**Cấu hình trên switch**

- SW1:
```

Switch(config)#vtp domain sontest
Switch(config)#vtp password sontest

#Cấu hình mode trunk

interface GigabitEthernet1/0/14
 switchport trunk encapsulation dot1q
 switchport mode trunk

```

- SW2:

```
Switch(config)#vtp domain sontest
Switch(config)#vtp password sontest
Switch(config)#vtp mode client

interface GigabitEthernet2/0/14
 switchport trunk encapsulation dot1q
 switchport mode trunk
```

- Tạo vlan trên sw1 và kiểm tra vlan trên sw2.
