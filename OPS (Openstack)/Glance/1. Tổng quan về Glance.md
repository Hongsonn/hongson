# Lý thuyết về Glance

## 1. Tổng quan về Glance - OpenStack Image Service

- Openstack Image Service còn được gọi là `Glance`, dịch vụ này cho phép người dùng register (đăng ký), discover (tìm kiếm) và retrieve (thu thập) các virtual machine để sử dụng trong Openstack cloud. Các image có sẵn có thể thông qua Glance có thể lưu trữ ở nhiều định dạng và backends khác nhau, từ các file local system đến các file object storage system như Swift và Ceph.
- Glance có RESTful API cho phép truy vấn vm image metadata
- Glance gồm 2 thành phần chính:
  - `Glance-api` service: Người dùng giao tiếp với `glance-api` một cách gián tiếp khi thực hiện việc tạo, liệt kê, xóa hoặc quản lý các image bằng Openstack Client.
  - `Glance-registry` service có trách nhiệm kết nối tới các backend database và lưu trữ hoặc thu thập thông tin của image

## 2. Các thành phần của Glance:

- `glance-api`: chấp nhận API calls cho việc tìm kiếm, lấy và lưu trữ image 
- `glance-registry`: Thực hiện lưu trữ, xử lý và lấy thông tin metadata của image
- `database`: lưu trữ metadata của image
- `storage repository`: Tích hợp nhiều thành của Openstack như file systems, Amazon S3, HTTP cho image storages.

![a](https://f8-zpcloud.zdn.vn/5131490920666600367/3bc5c4352ddbf485adca.jpg)

- Glance chấp nhận các API request cho image từ user hoặc Nova components và có thể lưu trữ nó trong object storage service, switf hoặc storage repository khác.
- Image server hỗ trợ các backends:
  - `File system`: Openstack Image server lưu trữ virtual machine images trong file system backend là default. Đây là backend đơn giản lưu trữ file image trong local file system
  - `Object storage`: là hệ thống lưu trữ do Openstack Swift cung cấp - dịch vụ lưu trữ có tính sẵn sàng cao. Lưu trữ các image dưới dạng các object.
  - `Block storage`: Hệ thống lưu trữ có tính sẵn sàng cáo do Openstack Cinder cung cấp, lưu trữ các image dưới dạng block.
  - `VMware`: ESX/ESXi hoặc vCenter Server target system
  - `S3`: The Amazon S3 Service
  - `HTTP`: Openstack Image Service có thể đọc virtual machine images có sẵn trên internet sử dụng HTTP. Đây là store chỉ đọc
  - `RADOS Block Device (RBD)`: Stores images trong Ceph storage cluster sử dụng Ceph's RBD interface 
  - `Sheepdog`: là 1 open-source distributed storage system, có tính năng quản lý đĩa máy ảo mạnh mẽ snapshotting, cloning, rollback dành cho QEMU/KVM
  - `GridFS`: Stores images sử dụng MongoDB

## 3. Kiến trúc của Glance

![a](https://f8-zpcloud.zdn.vn/3692454939681764668/3b15fd8f4d64943acd75.jpg)

- Glance có client-service architecture và cung cấp Rest API để request đến server được thực hiện. Request từ client được chấp nhận thông qua Rest API và chờ Keystone authentication. Glance Domain controller quản lý tất cả các hoạt động bên trong phân chia đến các layers, mỗi layer thực hiện nhiệm vụ của nó. 
- `Glance store` là layer giao tiếp giữa glance và storage backends bên ngoài hoặc local file system và cung cấp interface để truy cập. Glance sử dụng SQL central Database làm điểm truy cập cho các thành phần khác trong hệ thống.

- Kiến trúc Glance gồm các thành phần:
  - **Client**: bất kỳ ứng dụng nào sử dụng Glance server
  - **REST API**: gửi request tới Glance thông qua REST.
  - **Database Abstraction Layer (DAL)**: application programming interface (API) thống nhất việc giao tiếp giữa Glance và databases.
  - **Glance Domain Controller**: là phần mềm trung gian thực hiện các chức năng chính của Glance: authorization, notifications, policies, database connections.
  - **Glance Store**: Tổ chức việc tương tác giữa Glance và các hệ thống data stores khác.
  - **Registry Layer**: được sử dụng để tổ chức giao tiếp bảo mật giữa domain và DAL sử dụng 1 service riêng biệt.

## 4. Glance format 

- Khi upload image cho Glance, chúng ta cần chỉ định format của Virtual machine images. Glance hỗ trợ nhiều format khác nhau như **Disk Formats** và **Container Formats**
- Virtual disk là tương tự physical server boot driver
- Các loại virtualization khác nhau hỗ trợ disk formats khác nhau.
- Các định dạng image được Glance hỗ trợ: Iso, Qcow2, Raw, VDI, VHD, VMDK, AMI, ARI, AKI
- Các định dạng container Glance hỗ trợ: bare, OVF, AMI, ARI, AKI.

### 4.1. Disk format

Các disk format được hỗ trợ bởi Openstack 