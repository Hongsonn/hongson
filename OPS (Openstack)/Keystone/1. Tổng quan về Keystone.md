# Tổng quan về Keystone

## 1. Khái niệm Keystone

KeyStore là một OpenStack project cung cấp các dịch vụ Identify, Token, Catalog, Policy cho các dịch vụ khác trong OpenStack. Hai tính năng chính của Keystone:
- **User Managerment:** Keystone giúp xác thực tài khoản người dùng và chỉ định xem người dùng đó có quyền gì
- **Service Catalog**: Cung cấp 1 danh mục các dịch vụ sẵn sàng cùng với các API endpoint để truy cập các dịch vụ đó.

## 2. Một số khái niệm liên quan:

- **Authentication**: Là quá trình xác minh danh tính của người dùng dựa trên thông tin đăng nhập của người đó (credential). Khi xác định được danh tính người dùng nó cấp cho người dùng 1 token xác thực. Người dùng sẽ cung cấp token đó cho mỗi yêu cầu sau đó.
- **Credentials**: Là thông tin để xác thực người dùng. Có thể là username, password, API key hay token được cung cấp.
- **Domain**: Là 1 thực thể API v3 dịch vụ nhận dạng, tập hợp các project của người dùng để xác định danh giới để quản trị xác thực. Có thể là 1 cá nhân, tổ chức hoặc 1 nhà quản trị.
- **Endpoint**: Là 1 địa chỉ truy cập mạng, thường là địa chỉ URL của một dịch vụ để từ đó truy cập vào dịch vụ
- **Group**: LÀ 1 thực thể API v3 dịch vụ nhận dạng, là 1 nhóm những người dùng nằm trong cùng 1 domain. Quyền của 1 group được thêm vào domain hay 1 project sẽ được áp dụng đối với tất cả user trong group đó.
- **Openstack client**: LÀ 1 công cụ dòng lệnh cung cấp giao diện để truy cập các dịch vụ của Openstack
- **Project**: Sử dụng để nhóm hoặc cô lập tài nguyên, định danh các đối tượng. Tùy thuộc vào nhà quản lý
- **Region**: Là 1 thực thể API v3 dịch vụ nhận dạng, đại diện cho 1 bộ phận chung trong triển khai Openstack. Có thể tạo và liên kết chúng với các region phụ để tạo cấu trúc dạng cây.
- **Roles**: Là tập hợp các quyền hạn và đặc quyền của người dùng để thực hiện các hành động cụ thể. Token được gửi đến người dùng sau khi xác thực sẽ bao gồm cả tập hợp các quyền. Khi người dùng yêu cầu 1 dịch vụ, dịch vụ này sẽ kiểm tra quyền của người dùng và cung cấp dịch vụ trong quyền hạn đó.
- **Service**: Một dịch vụ Openstack như Compute (nova), Object Storage (swift), hay Image service (glance), là một hay nhiều endpoint mà qua đó người dùng có thể truy cập vào tài nguyên và thực hiện các hành động 
- **Token**: Một chuỗi gồm chữ và số cho phép truy cập vào các tài nguyên và API Openstack. Token có thể bị thu hồi bất cứ lúc nào và có tác dụng trong khoảng thời gian hữu hạn.
- **User**: Đại diện cho 1 người dùng, hệ thống, hay dịch vụ mà sử dụng dịch vụ OpenStack.

### 2.1. Users và User Groups (Actors):

- Trong Keystone, User và User Groups là những đối tượng được cấp phép truy cập tới các nguồn tài nguyên được cô lập trong domains và projects.
- Users và User Groups được gọi là **Actors**
- Mối quan hệ giữa domains, projects, users và user groups:

![a](https://f7-zpcloud.zdn.vn/9067756696770760005/3f0de9118ace53900adf.jpg)

### 2.2 Roles

- Roles được dùng để thực hiện hóa việc cấp phép trong keystone. Một Actor có thể có nhiều roles đối với từng projects khác nhau

### 2.3. Assignment:

- Role Assignment là swjkeest hợp của Actor, target và role.
- Role assignment được cấp phát, thu hồi, và có thể được kế thừa giữa các users, groups, project, domains.

### 2.4. Targets

- Projects và Domains đều giống nhau ở chỗ cả 2 đều được role **gán** lên vì thế chúng được gọi là **Targets**

### 2.5. Token

- Để user truy cập bất cứ OpenStack API nào thì user cần chứng minh họ là ai và được phép gọi tới API. Để làm được điều này, họ cần có token và "gán" chúng vào `API call`. Keystone chính là service chịu trách nhiệm tạo ra tokens.
- Sau khi xác thực thành công bởi Keystone thì user sẽ được cấp token. Token sẽ chứa các thông tin ủy quyền của user trên cloud.
- `Token` gồm có `ID` và `payload`. Phần `ID` là duy nhất trên cloud và phần `payload` chứa dữ liệu về người dùng. 

### 2.6. Catalog

- Chứa URLs và endpoints của các service khác nhau.
- Nếu không có Catalog, users và các ứng dụng sẽ không biết được nơi cần chuyển yêu cầu để tạo máy ảo hoặc lưu dữ liệu.
- Catalog được chia thành 1 danh sách các endpoints, mỗi 1 endpoint sẽ chứa admin URL, internal URL and public URL


