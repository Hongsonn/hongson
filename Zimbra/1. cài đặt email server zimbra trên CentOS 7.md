### 1. Chuẩn bị 
- Phiên bản: zimbra 8.8 trên CentOS 7
- Cấu hình tối thiểu: RAM: 2GB, Disk: 30GB, CPU: 3 core
- Chuẩn bị tên miền: Một tên miền đã trỏ bản ghi mail

![a](blob:https://chat.zalo.me/abc333f3-ec9d-40b7-a78a-05a75efc2d4d)

- Tên miền: chichchich.xyz
- Update OS: 

```
yum install epel-release -y
yum update -y
```

-  Cài đặt NTP (Network Time Protocol) đồng bộ thời gian:

```
yum install chrony -y 
systemctl start chronyd 
systemctl enable chronyd
systemctl restart chronyd 
chronyc sources -v
ln -f -s /usr/share/zoneinfo/Asia/Ho_Chi_Minh /etc/localtime
```

![a](https://f4-zpcloud.zdn.vn/5119997819557885956/69bdebf15e289476cd39.jpg)

![a](https://f4-zpcloud.zdn.vn/4644370771879417980/3fba97443c9df6c3af8c.jpg)

- Cài đặt cmdlog
```
curl -Lso- https://raw.githubusercontent.com/nhanhoadocs/ghichep-cmdlog/master/cmdlog.sh | bash
```

Exit phiên kết nối ssh ra và truy cập lại.

- Thiết lập Firewall, selinux và một số package cơ bản:

```
sudo systemctl disable firewalld
sudo systemctl stop firewalld
sed -i 's/SELINUX=enforcing/SELINUX=disabled/g' /etc/sysconfig/selinux
sed -i 's/SELINUX=enforcing/SELINUX=disabled/g' /etc/selinux/config
yum install -y git wget byobu


service sendmail stop
service iptables stop
service ip6tables stop
chkconfig sendmail off
chkconfig iptables off
chkconfig ip6tables off
service httpd stop
chkconfig httpd off

init 6
```

### 2. Cài đặt email server zimbra

- Cài package cần thiết:
```
yum install unzip net-tools sysstat openssh-clients perl-core libaio nmap-ncat libstdc++.so.6 nano wget -y 
```

- Đổi host name, add hostname:

```
hostnamectl set-hostname mail.chichchich.xyz
cat << EOF >> /etc/hosts
103.101.163.27 mail.chichchich.xyz mail
EOF

init 6
```

![a](https://f5-zpcloud.zdn.vn/2518496191332216014/b9a44040a0996ac73388.jpg)

- Lưu ý: File `/etc/resolv.conf` phải khai báo `nameserver 8.8.8.8` để có thể connect tới server download bộ cài zimbra.

![a](https://f5-zpcloud.zdn.vn/5670938272347198521/64691d7d09a5c3fb9ab4.jpg)

- Tari Zimbra 8.8
```
wget https://files.zimbra.com/downloads/8.8.15_GA/zcs-8.8.15_GA_3869.RHEL7_64.20190918004220.tgz
```

- Giải nén và vài đặt: 
```
tar -xvf zcs-8.8.15_GA_3869.RHEL7_64.20190918004220.tgz
cd zcs-8.8.15_GA_3869.RHEL7_64.20190918004220
./install.sh
```

![blob:https://chat.zalo.me/0856a3f4-981a-4db3-b85a-4ff0167aac44]

- Ở bước này lưu ý một số tùy chọn cài đặt như sau:

```
Do you agree with the terms of the software license agreement? [N] y

Use Zimbra's package repository [Y] y

Select the packages to install

Install zimbra-ldap [Y] y

Install zimbra-logger [Y] y

Install zimbra-mta [Y] y

Install zimbra-dnscache [Y] n

Install zimbra-snmp [Y] y

Install zimbra-store [Y] y

Install zimbra-apache [Y] y

Install zimbra-spell [Y] y

Install zimbra-memcached [Y] y

Install zimbra-proxy [Y] y

Install zimbra-drive [Y] y

Install zimbra-imapd (BETA - for evaluation only) [N] n

Install zimbra-chat [Y] y

The system will be modified.  Continue? [N] y
```

![a](https://f5-zpcloud.zdn.vn/7950086851064063079/ac798aedb835726b2b24.jpg)

![a](https://f5-zpcloud.zdn.vn/4919299146853757881/8cb2fc3fcce706b95ff6.jpg)

![a](https://f5-zpcloud.zdn.vn/2980579112545551886/37ed81b43e6cf432ad7d.jpg)

- Hệ thống sẽ báo password account admin zimbra chưa được nhập, cần đặt lại password admin zimbra:

![a](https://f5-zpcloud.zdn.vn/8527880935015621213/a7b925978b4f4111185e.jpg)

- Chọn `a` để apply cấu hình 
```
Select from menu, or press 'a' to apply config (? - help)
```

```
*** CONFIGURATION COMPLETE - press 'a' to apply
Select from menu, or press 'a' to apply config (? - help) a
Save configuration data to a file? [Yes] yes
Save config in file: [/opt/zimbra/config.12171]
Saving config in /opt/zimbra/config.12171...done.
The system will be modified - continue? [No] yes
Operations logged to /tmp/zmsetup.20211227-163658.log
Setting local config values...done.
Initializing core config...Setting up CA...done.
Deploying CA to /opt/zimbra/conf/ca ...done.
Initializing ldap...done.
...
```

- Blocking Memcached Exploit
Chỉ định cấu hình memcached để lắng nghe trên 127.0.0.1 để tránh cuộc tấn công này. Sử dụng các lệnh dưới đây.
```
